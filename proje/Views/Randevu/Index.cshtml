@using proje.Models
@model Musteri

@{
    ViewData["Title"] = "Randevularım";
}

<h2 class="mb-4">Randevular</h2>

<!-- ÜST BUTONLAR -->
<div class="mb-4">
    <a asp-action="RandevuAl" class="btn btn-success me-2">
        ➕ Randevu Al
    </a>

    <button class="btn btn-info" id="aiBtn">
        🤖 Yapay Zeka Önerisi Al
    </button>
</div>

<hr />


<h4>Aktif / Bekleyen Randevularım</h4>
<div class="mb-3">
    <button class="btn btn-outline-success filter-btn" data-filter="Aktif">
        Aktif Randevular
    </button>
    <button class="btn btn-outline-warning filter-btn" data-filter="Beklemede">
        Bekleyen Randevular
    </button>
    <button class="btn btn-outline-secondary filter-btn" data-filter="Iptal">
        İptal Edilenler
    </button>
</div>


@if (Model.Randevular == null || !Model.Randevular.Any())
{
    <div class="alert alert-secondary">
        Henüz randevunuz bulunmamaktadır.
    </div>
}
else
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Tarih</th>
                <th>Saat</th>
                <th>Antrenör</th>
                <th>Durum</th>
                <th>İşlem</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model.Randevular)
            {
                <tr data-durum="@r.Durum">

                    <td>@r.Tarih.ToShortDateString()</td>
                    <td>
                        @r.BaslangicSaat - @r.BitisSaat
                    </td>
                    <td>@r.Trainer?.AdSoyad</td>
                    <td>
                        @if (r.Durum == "Beklemede")
                        {
                            <span class="badge bg-warning">Beklemede</span>
                        }
                        else if (r.Durum == "Aktif")
                        {
                            <span class="badge bg-success">Aktif</span>
                        }
                        else if (r.Durum == "Iptal")
                        {
                            <span class="badge bg-secondary">İptal Edildi</span>
                        }
                        else
                        {
                            <span class="badge bg-dark">Bilinmiyor</span>
                        }

                    </td>
                    <td>
                        @if (r.Durum == "Beklemede" || r.Durum == "Aktif")
                        {
                            <form asp-action="RandevuIptal"
                                  asp-controller="Musteri"
                                  method="post"
                                  style="display:inline">
                                <input type="hidden" name="id" value="@r.Id" />
                                <button class="btn btn-danger btn-sm">
                                    İptal Et
                                </button>
                            </form>

                        }
                    </td>

                </tr>
            }
        </tbody>
    </table>
}

<div class="modal fade" id="aiModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Yapay Zeka Önerisi</h5>
            </div>
            <div class="modal-body">
                Yapay zeka sizin için uygun egzersiz planını hazırlıyor...
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $("#aiBtn").click(function () {
            $("#aiModal").modal("show");
        });
              // Varsayılan: sadece Aktif göster
        $(document).ready(function () {
            filtrele("Aktif");
        });

        $(".filter-btn").click(function () {
            let durum = $(this).data("filter");
            filtrele(durum);
        });

        function filtrele(durum) {
            $("tbody tr").each(function () {
                let rowDurum = $(this).data("durum");
                if (rowDurum === durum) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
    </script>
}
