@{
    ViewData["Title"] = "Randevu Al";
    var hizmetler = ViewBag.Hizmetler;
}

<h2 class="mb-4">Randevu Al</h2>

<div class="mb-3">
    <label class="form-label">Hizmet Seç</label>
    <select id="hizmetSelect" class="form-select">
        <option value="">Hizmet seçiniz</option>
        @foreach (var h in hizmetler)
        {
            <option value="@h.Id">@h.Ad</option>
        }
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Antrenör Seç</label>
    <select id="trainerSelect" class="form-select" disabled>
        <option value="">Önce hizmet seçiniz</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Tarih Seç</label>
    <input type="date" id="tarihInput" class="form-control" />
</div>

<div class="mb-3">
    <label class="form-label">Saat Seç</label>
    <select id="saatSelect" class="form-select" disabled>
        <option value="">Önce tarih seçiniz</option>
    </select>
</div>

<button class="btn btn-success" disabled id="randevuBtn">
    Randevu Al
</button>


@section Scripts {
    <script>

        function disableAll() {
            $("#trainerSelect, #saatSelect, #randevuBtn").prop("disabled", true);
            $("#trainerSelect").html("<option>Önce hizmet seçiniz</option>");
            $("#saatSelect").html("<option>Önce tarih seçiniz</option>");
        }

        disableAll();

        // HİZMET SEÇ
        $("#hizmetSelect").change(function () {
            let hizmetId = $(this).val();
            disableAll();

            if (!hizmetId) return;

            $.get("/Randevu/GetTrainerByHizmet", { hizmetId }, function (data) {
                $("#trainerSelect").empty().append("<option value=''>Antrenör seçiniz</option>");

                data.forEach(t => {
                    $("#trainerSelect").append(`<option value="${t.id}">${t.adSoyad}</option>`);
                });

                $("#trainerSelect").prop("disabled", false);
                    $("#tarihInput").prop("disabled", false);
            });
            }
        });

        // ANTRENÖR SEÇ → TARİH AKTİF
        $("#trainerSelect").change(function () {
            $("#saatSelect, #randevuBtn").prop("disabled", true);
        });

        // TARİH SEÇ → BOŞ SAATLER
        $("#tarihInput").change(function () {
            let trainerId = $("#trainerSelect").val();
            let tarih = $(this).val();

            if (!trainerId || !tarih) return;

            $("#saatSelect").prop("disabled", true)
                            .html("<option>Yükleniyor...</option>");

            $.get("/Randevu/GetUygunSaatler", { trainerId, tarih }, function (saatler) {

                $("#saatSelect").empty().append("<option value=''>Saat seçiniz</option>");

                saatler.forEach(saat => {
                    $("#saatSelect").append(`<option value="${saat}">${saat}</option>`);
                });

                $("#saatSelect").prop("disabled", false);
            });
            }
        }
        $("#trainerSelect").change(function () 
        {
            saatleriGetir();
        });

        $("#tarihInput").change(function () {
            saatleriGetir();
        });

        // SAAT SEÇ → BUTON AKTİF
        $("#saatSelect").change(function () {
            $("#randevuBtn").prop("disabled", !$(this).val());
        });

        // RANDEVU AL
        $("#randevuBtn").click(function () {

            $.post("/Randevu/RandevuAl", {
                trainerId: $("#trainerSelect").val(),
                tarih: $("#tarihInput").val(),
                saat: $("#saatSelect").val()
            }, function (res) {
                alert(res.mesaj);
            });
        });

    </script>
}


